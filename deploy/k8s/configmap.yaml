apiVersion: v1
kind: ConfigMap
metadata:
  name: digest-config
  namespace: digest
data:
  APP_ENV: "prod"
  # Digest settings
  DIGEST_WINDOW: "60m"
  DIGEST_TOP_N: "50"
  RELEVANCE_THRESHOLD: "0.5"
  IMPORTANCE_THRESHOLD: "0.5"
  CLUSTER_SIMILARITY_THRESHOLD: "0.6"
  SUMMARY_MAX_CHARS: "220"
  SUMMARY_STRIP_PHRASES_RU: "сводка:,итог:,итоги:,дайджест:,summary:,summary,дайджест"
  SUMMARY_STRIP_PHRASES_UK: "зведення:,підсумок:,підсумки:,дайджест:,summary:,summary,дайджест"
  SUMMARY_STRIP_PHRASES_EN: "summary:,summary,digest:,digest"
  # Health & monitoring
  HEALTH_PORT: "8080"
  # Leader election
  LEADER_ELECTION_ENABLED: "true"
  LEADER_ELECTION_LEASE_NAME: "digest-scheduler-lease"
  # Telegram session
  TG_SESSION_PATH: "/app/data/tg.session"
  # Worker settings
  WORKER_BATCH_SIZE: "10"
  WORKER_POLL_INTERVAL: "10s"
  # Reader settings
  READER_FETCH_LIMIT: "20"
  RATE_LIMIT_RPS: "10"
  # Scheduler settings
  SCHEDULER_TICK_INTERVAL: "10m"
  SCHEDULER_CATCHUP_WINDOW: "24h"
  FACTCHECK_GOOGLE_ENABLED: "true"
  # Enrichment settings (Phase 2)
  ENRICHMENT_ENABLED: "true"
  ENRICHMENT_MAX_RESULTS: "5"
  ENRICHMENT_MAX_SECONDS: "1200"
  ENRICHMENT_CACHE_TTL_HOURS: "168"
  ENRICHMENT_QUEUE_MAX: "5000"
  ENRICHMENT_MIN_AGREEMENT: "0.03"
  ENRICHMENT_MAX_EVIDENCE_PER_ITEM: "5"
  ENRICHMENT_DEDUP_SIMILARITY: "0.98"
  ENRICHMENT_ALLOWLIST_DOMAINS: ""
  ENRICHMENT_DENYLIST_DOMAINS: "didaktorika.gr,arxiv.org,readhacker.news"
  ENRICHMENT_SKIP_NAVIGATION_PAGES: "true"
  ENRICHMENT_SKIP_SOCIAL_MEDIA: "true"
  ENRICHMENT_QUERY_TRANSLATE: "true"
  ENRICHMENT_PROVIDERS: "solr,gdelt,newsapi,searxng"
  ENRICHMENT_PROVIDER_COOLDOWN: "10m"
  ENRICHMENT_PROVIDER_GRACE: "3s"
  # Solr provider (SolrCloud)
  SOLR_URL: "http://solr:8983/solr/news"
  SOLR_TIMEOUT: "10s"
  SOLR_MAX_RESULTS: "10"
  ENRICHMENT_DAILY_BUDGET_USD: "100"
  ENRICHMENT_MONTHLY_CAP_USD: "2000"
  # OpenSearch provider (disabled by default - requires pre-populated index)
  ENRICHMENT_OPENSEARCH_ENABLED: "false"
  ENRICHMENT_OPENSEARCH_URL: ""
  ENRICHMENT_OPENSEARCH_INDEX: "news"
  ENRICHMENT_OPENSEARCH_RPM: "60"
  ENRICHMENT_OPENSEARCH_TIMEOUT: "30s"
  # Event Registry provider
  ENRICHMENT_EVENTREGISTRY_ENABLED: "false"
  ENRICHMENT_EVENTREGISTRY_TIMEOUT: "30s"
  # NewsAPI provider
  ENRICHMENT_NEWSAPI_ENABLED: "true"
  ENRICHMENT_NEWSAPI_TIMEOUT: "30s"
  SEARXNG_ENABLED: "true"
  SEARXNG_BASE_URL: "http://searxng:8080"
  SEARXNG_TIMEOUT: "30s"
  SEARXNG_ENGINES: "brave,qwant,wikipedia,arxiv,crossref"
  GDELT_ENABLED: "true"
  GDELT_RPM: "30"
  GDELT_TIMEOUT: "30s"
  # Evidence-enhanced clustering
  EVIDENCE_CLUSTERING_BOOST: "0.15"
  EVIDENCE_CLUSTERING_MIN_SCORE: "0.25"
  # Telegram link seeding (seeds URLs from messages into crawler queue)
  MAX_LINKS_PER_MESSAGE: "3"
  CRAWLER_QUEUE_MAX_PENDING: "10000"
  LINK_SEED_EXT_DENYLIST: ".zip,.exe,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.rar,.7z,.tar,.gz"
  # Link enrichment
  LINK_ENRICHMENT_SCOPE: "summary, relevance, topic, dedup, queries, factcheck"
  ENRICHMENT_LANGUAGE_POLICY: '{
  "default": [ "en" ],
  "context": [ { "name": "cyprus","languages": [ "el" ],"keywords": [ "cyprus","nicosia","limassol","larnaca","paphos" ] } ]
}'
  ENRICHMENT_LLM_TIMEOUT: "120s"
  OPENAI_EMBEDDING_MODEL: "text-embedding-3-small"
  OPENAI_EMBEDDING_DIMENSIONS: "1536"
  COHERE_EMBEDDING_MODEL: "embed-multilingual-v3.0"
  EMBEDDING_CIRCUIT_THRESHOLD: "5"
  EMBEDDING_CIRCUIT_TIMEOUT: "1m"
  # Bot settings
  TELEGRAM_BOT_USERNAME: "IDigestBot"
  # Expanded view (on-demand item detail pages)
  EXPANDED_VIEW_BASE_URL: "https://digest.lueurxax.org"
  EXPANDED_VIEW_TTL_HOURS: "72"
  EXPANDED_VIEW_REQUIRE_ADMIN: "true"
  EXPANDED_VIEW_ALLOW_SYSTEM_TOKENS: "true"
  # Apple Shortcuts integration for ChatGPT (iOS/macOS)
  EXPANDED_CHATGPT_SHORTCUT_NAME: "Ask ChatGPT"
  EXPANDED_CHATGPT_SHORTCUT_ICLOUD_URL: "https://www.icloud.com/shortcuts/f658b37493e94db3aa8d50757b7ad16f"
  EXPANDED_SHORTCUT_URL_MAX_CHARS: "2000"
  BULLET_MIN_IMPORTANCE: "0.4"